---
layout: demo.html
---

<div class="container">
  <div class="jumbotron">
    <div class="row">
      <div class="col-md-6">
        <h1>React Hooks keyed</h1>
      </div>
      <div class="col-md-6">
        <div class="row">
          <div class="col-sm-6 smallpad">
            <button type="button" class="btn btn-primary btn-block" id="run">Create 1,000 rows</button>
          </div>
          <div class="col-sm-6 smallpad">
            <button type="button" class="btn btn-primary btn-block" id="runlots">Create 10,000 rows</button>
          </div>
          <div class="col-sm-6 smallpad">
            <button type="button" class="btn btn-primary btn-block" id="add">Append 1,000 rows</button>
          </div>
          <div class="col-sm-6 smallpad">
            <button type="button" class="btn btn-primary btn-block" id="update">Update every 10th row
          </div>
          <div class="col-sm-6 smallpad">
            <button type="button" class="btn btn-primary btn-block" id="clear">Clear</button>
          </div>
          <div class="col-sm-6 smallpad">
            <button type="button" class="btn btn-primary btn-block" id="swaprows">Swap Rows</button>
          </div>
          <div class="col-sm-6 smallpad">
            <button type="button" class="btn btn-primary btn-block" id="rotate-forward">Rotate forward</button>
          </div>
          <div class="col-sm-6 smallpad">
            <button type="button" class="btn btn-primary btn-block" id="rotate-backward">Rotate backward</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <table class="table table-hover table-striped test-data">
    <tbody>
      <template json-each="data" json-key="id">
        <tr @class="$parent.selected == id ? 'danger' : ''" json-ignore="$prev === $this" @data-id="id">
          <td class="col-md-1">${id}</td>
          <td class="col-md-4">
            <a json-select="id">${label}</a>
          </td>
          <td class="col-md-1">
            <a json-remove="id">
              <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
            </a>
          </td>
          <td class="col-md-6" />
        </tr>
      </template>
    </tbody>
  </table>

  <script type="module">

    const random = (max) => Math.round(Math.random() * 1000) % max;

    const A = ["pretty", "large", "big", "small", "tall", "short", "long", "handsome", "plain", "quaint", "clean",
      "elegant", "easy", "angry", "crazy", "helpful", "mushy", "odd", "unsightly", "adorable", "important", "inexpensive",
      "cheap", "expensive", "fancy"];
    const C = ["red", "yellow", "blue", "green", "pink", "brown", "purple", "brown", "white", "black", "orange"];
    const N = ["table", "chair", "house", "bbq", "desk", "car", "pony", "cookie", "sandwich", "burger", "pizza", "mouse",
      "keyboard"];

    let nextId = 1;

    const buildData = (count) => {
      const data = new Array(count);

      for (let i = 0; i < count; i++) {
        data[i] = {
          id: nextId++,
          label: `${A[random(A.length)]} ${C[random(C.length)]} ${N[random(N.length)]}`,
        };
      }

      return data;
    };
    let json = {
      data: [],
      selected: 0
    }

    const target = document.querySelector('tbody');
    htmxJson.swap(target, json);

    document.querySelector('#run').addEventListener('click', () => {
      json.data = buildData(1000);
      htmxJson.swap(target, json);
    });
    document.querySelector('#runlots').addEventListener('click', () => {
      json.data = buildData(10000);
      htmxJson.swap(target, json);
    });
    document.querySelector('#add').addEventListener('click', () => {
      json.data.push(...buildData(1000));
      htmxJson.swap(target, json);
    });
    document.querySelector('#update').addEventListener('click', () => {
      for (let i = 0; i < json.data.length; i += 10) {
        const r = json.data[i];
        json.data[i] = { id: r.id, label: r.label + " !!!" };
      }
      htmxJson.swap(target, json);
    });
    document.querySelector('#clear').addEventListener('click', () => {
      json.data = [];
      htmxJson.swap(target, json);
    });
    document.querySelector('#swaprows').addEventListener('click', () => {
      if (json.data.length > 998) {
        const d1 = json.data[1];
        const d998 = json.data[998];
        json.data[1] = d998;
        json.data[998] = d1;
      }
      htmxJson.swap(target, json);
    });

    htmxJson.directives.push({
      match: attr => attr.name === 'json-select',
      factory(elm, attr, createGetter) {
        const getter = createGetter(attr.value);
        let id = ''
        elm.addEventListener('click', () => {
          json.selected = id;
          htmxJson.swap(target, json);
        });
        return ($ctx) => {
          id = getter($ctx);
        }
      }
    });

    htmxJson.directives.push({
      match: attr => attr.name === 'json-remove',
      factory(elm, attr, createGetter) {
        const getter = createGetter(attr.value);
        let id = ''
        elm.addEventListener('click', () => {
          const index = json.data.findIndex(d => d.id == id);
          json.data.splice(index, 1);
          htmxJson.swap(target, json);
        });
        return ($ctx) => {
          id = getter($ctx);
        }
      }
    });

    document.querySelector('#rotate-forward').addEventListener('click', () => {
      json.data.unshift(json.data.pop())
      htmxJson.swap(target, json);
    });
    document.querySelector('#rotate-backward').addEventListener('click', () => {
      json.data.push(json.data.shift());
      htmxJson.swap(target, json);
    });

  </script>
</div>